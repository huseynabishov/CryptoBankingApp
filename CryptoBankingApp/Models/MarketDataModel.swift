//
//  MarketDataModel.swift
//  CryptoBankingApp
//
//  Created by Huseyn Abishov on 30.08.2022.
//

import Foundation

// JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
 "data": {
 "active_cryptocurrencies": 12892,
 "upcoming_icos": 0,
 "ongoing_icos": 49,
 "ended_icos": 3376,
 "markets": 563,
 "total_market_cap": {
 "btc": 51014563.44609426,
 "eth": 661570901.7593008,
 "ltc": 19048615974.908882,
 "bch": 8849799614.383835,
 "bnb": 3575247823.016218,
 "eos": 721088820793.9093,
 "xrp": 3100475623163.691,
 "xlm": 9845164011451.686,
 "link": 155035217462.48425,
 "dot": 143345406314.0839,
 "yfi": 113578456.02828124,
 "usd": 1006684973901.0251,
 "aed": 3697579076262.8228,
 "ars": 139510732428592.17,
 "aud": 1463178355536.1372,
 "bdt": 95548349630151.03,
 "bhd": 379477954391.7835,
 "bmd": 1006684973901.0251,
 "brl": 5105805519128.618,
 "cad": 1317219101170.2263,
 "chf": 979745077314.4612,
 "clp": 887624342037754.6,
 "cny": 6958105871106.485,
 "czk": 24643459911007.035,
 "dkk": 7468696489869.132,
 "eur": 1004194435275.5946,
 "gbp": 863506183433.03,
 "hkd": 7901198555206.223,
 "huf": 405577821695192.2,
 "idr": 14950187082020822,
 "ils": 3350182158619.318,
 "inr": 80115524693987.22,
 "jpy": 139650862976959.25,
 "krw": 1359006529002333,
 "kwd": 310130446594.66327,
 "lkr": 360645149611396.3,
 "mmk": 2111565804418878.8,
 "mxn": 20219024083038.434,
 "myr": 4520015532815.615,
 "ngn": 422304346551481.1,
 "nok": 9863009118699.965,
 "nzd": 1638831796577.2043,
 "php": 56619989672089.5,
 "pkr": 223484064206028.2,
 "pln": 4742609687504.71,
 "rub": 61434060905836.65,
 "sar": 3781240637703.8394,
 "sek": 10734130873960.564,
 "sgd": 1406807017052.5974,
 "thb": 36689641565481.81,
 "try": 18312104024431.613,
 "twd": 30677013215178.18,
 "uah": 37085067423230.15,
 "vef": 100799366436.71005,
 "vnd": 23575761806421710,
 "zar": 17033399683677.871,
 "xdr": 744475752118.9758,
 "xag": 54639870528.97532,
 "xau": 583172605.3808632,
 "bits": 51014563446094.26,
 "sats": 5101456344609426
 },
 "total_volume": {
 "btc": 3410337.7003391366,
 "eth": 44226198.07579357,
 "ltc": 1273405255.4847,
 "bch": 591611556.1249721,
 "bnb": 239006307.5178806,
 "eos": 48204987453.14337,
 "xrp": 207267654418.53735,
 "xlm": 658151941842.1356,
 "link": 10364147241.037817,
 "dot": 9582680127.017326,
 "yfi": 7592751.2532544015,
 "usd": 67297169414.91207,
 "aed": 247184185690.20804,
 "ars": 9326331115347.021,
 "aud": 97813878452.13728,
 "bdt": 6387433645163.08,
 "bhd": 25368206388.306484,
 "bmd": 67297169414.91207,
 "brl": 341324513555.4931,
 "cad": 88056461858.66911,
 "chf": 65496229864.1997,
 "clp": 59337933188210.664,
 "cny": 465151305278.93005,
 "czk": 1647422122706.3706,
 "dkk": 499284429606.1765,
 "eur": 67130676217.77962,
 "gbp": 57725627603.36795,
 "hkd": 528197312501.9048,
 "huf": 27112989748703.504,
 "idr": 999424148494644.1,
 "ils": 223960605496.81607,
 "inr": 5355745022400.536,
 "jpy": 9335698881329.58,
 "krw": 90849962986766,
 "kwd": 20732306278.82141,
 "lkr": 24109228170967.67,
 "mmk": 141158759050558.28,
 "mxn": 1351647361783.5125,
 "myr": 302164290672.956,
 "ngn": 28231162569555.688,
 "nok": 659344892205.8041,
 "nzd": 109556359651.83698,
 "php": 3785061996572.3306,
 "pkr": 14939971610110.52,
 "pln": 317044771585.3034,
 "rub": 4106883992322.899,
 "sar": 252776984251.6036,
 "sek": 717579622895.7964,
 "sgd": 94045438856.41019,
 "thb": 2452712703793.0596,
 "try": 1224169227539.1301,
 "twd": 2050766832731.4446,
 "uah": 2479147031939.2383,
 "vef": 6738465573.515172,
 "vnd": 1576046208601067.8,
 "zar": 1138687488085.1064,
 "xdr": 49768410291.74895,
 "xag": 3652690483.2482758,
 "xau": 38985250.242058516,
 "bits": 3410337700339.1367,
 "sats": 341033770033913.7
 },
 "market_cap_percentage": {
 "btc": 37.51221554649044,
 "eth": 18.192739236477408,
 "usdt": 6.713944465708803,
 "usdc": 5.163743077180023,
 "bnb": 4.564209481501848,
 "busd": 1.9059312419488443,
 "xrp": 1.601095503913123,
 "ada": 1.4974408473364644,
 "sol": 1.0801484876034975,
 "doge": 0.8159649656477426
 },
 "market_cap_change_percentage_24h_usd": -1.3279104845866612,
 "updated_at": 1661874190
 }
 }
 
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "\(item.value)"
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd"}) {
            return "\(item.value)"
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return""
    }
}
